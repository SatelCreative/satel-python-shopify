# Development - Contributing

## Contributing

If you want to contribute a small change/feature, the best is to just create a PR with
your changes.
For bigger changes/features it's best to open an issue first and discuss it to agree
on the code organization and overall implementation before spending too much time on
the code, unless you want to keep it in your own forked repo.

## Setting up the development environment

We use the [python poetry](https://python-poetry.org/) package to manage this package.
Follow the official instructions to install poetry on your system then once you clone
this repository just just need to do the following to install the dependencies from
the development environment, as well as install `spylib` in
[editable mode](https://pip.pypa.io/en/stable/cli/pip_install/#install-editable):

```bash
poetry install
```

Then you can start monitoring the code for changes and run the test suite this way:

```bash
poetry shell
scripts/test_watch.sh
```

## Build and run documentation (lazydocs/mkdocs)

Documentation for this package is handled by `lazydocs` and so it needs a few steps to generate it locally.

Inside `poetry shell`:

```bash
lazydocs --overview-file="index.md" \
--src-base-url="https://github.com/SatelCreative/satel-spylib/tree/main" \
--output-path="./docs/api-docs" \
--validate spylib

mkdocs build
mkdocs serve
```

The default URL is at `127.0.0.1:8000`.

### Duplicating README.md and index.md

The documentation homepage is stored in two locations:

* `README.md`: This is the homepage of the Github repository
* `docs/index.md`: This is the homepage in the documentation site generated by mkdocs

We want only one homepage for simplicity sake so make sure to edit both files identically,
or just edit one file and copy the new version to overwrite the other file when you're done editing.
A Github action verifies that the two files are identical and will prevent a PR merge is they aren't.

## Publishing to pipy

We use [poetry](https://python-poetry.org/) to manage the dependencies and publish to pypi.


1. Create branch `release/x.y.z`
2. Change the version in the `pyproject.toml` and `spylib/__init__.py` files
    * you can use `poetry version XXXXX` to change `pyproject.toml`
3. Generate the CHANGELOG.md using Github's [automatically generated release notes](https://docs.github.com/en/repositories/releasing-projects-on-github/automatically-generated-release-notes),
   but **don't create the release**, just make the changelog through the UI.
3. Commit to git
4. Open PR for other codeowners to review
5. Once approved, squash and merge `release/x.y.z`
6. Run `poetry publish --build` to create the package and publish to PyPI
7. Create the matching release in Github with Github's
[automatically generated release notes](https://docs.github.com/en/repositories/releasing-projects-on-github/automatically-generated-release-notes)

**Notes**:

- It's better to tag after publishing in case there is an issue while publishing
